from asyncio import sleep

from aiogram.types import (
    InlineQuery,
    CallbackQuery,
    InlineQueryResultArticle,
    InputTextMessageContent,
    InlineKeyboardMarkup,
    InlineKeyboardButton
)

from pyrogram import Client, types
from .. import loader, utils, inline

@loader.module(name="TEST", author="ecXbe")
class ExampleMod(loader.Module):
  
  """dsfa"""
  
  async def ghoul_inline_handler(self, app: Client, inline_query: InlineQuery, args: str):
  
        """Гуль"""
        
        await inline_query.answer(
            [
                InlineQueryResultArticle(
                    id=inline.result_id(),
                    title="Ghoul",
                    description="Запустить гуля" + (
                        f" Аргументы: {args}" if args
                        else ""
                    ),
                    input_message_content=InputTextMessageContent(
                        "Нажми на кнопочку"),
                    reply_markup=InlineKeyboardMarkup().add(
                        InlineKeyboardButton("Запустить гуля", callback_data="ghoul_button_callback"))
                )
            ]
        )

        @loader.on_bot(lambda self, app, call: call.data == "ghoul_button_callback")
        async def ghoul_callback_handler(self, app: Client, call: CallbackQuery):

            """Пример каллбека"""

            await app.send_message(message.chat.id, 'Я гуль')
            await sleep(2)
            a = 1000
            while a > 0:
                c = a - 7
                await app.send_message(message.chat.id, str(a) + " - 7 = " + str(c))
                a = c
                await sleep(0.1)
            await app.send_message(message.chat.id, 'l l let me die')


    async def test_cmd(self, app: Client, message: types.Message, args: str):  # _cmd на конце функции чтобы обозначить что это команда
                                                                                  # args - аргументы после команды. необязательный аргумент
        """Описание команды. Использование: example [аргументы]"""
        await utils.answer(  # utils.answer - это круто
            message, "Ого пример команды" + (
                f"\nАргументы: {args}" if args
                else ""
            )
        )

        await sleep(2.5)  # никогда не используй time.sleep, потому что это не асинхронная функция, она остановит весь юзербот
        return await utils.answer(
            message, "Прошло 2.5 секунды!")
